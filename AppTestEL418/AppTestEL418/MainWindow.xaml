<Window x:Class="AppTestEL418.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:gif="http://wpfanimatedgif.codeplex.com"
        Title="TEST EL418 APP" Height="700" Width="900"
        Background="#1E1E1E" Foreground="White"
        WindowStartupLocation="CenterScreen"
        Icon="Images/logo.ico"
        Closing="Window_Closing">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Ligne du haut : COM -->
            <RowDefinition Height="Auto"/>
            <!-- Ligne infos état -->
            <RowDefinition Height="*"/>
            <!-- Image + instructions -->
            <RowDefinition Height="Auto"/>
            <!-- Zone PER -->
            <RowDefinition Height="Auto"/>
            <!-- Boutons test étape -->
            <RowDefinition Height="200"/>
            <!-- Log trames -->
        </Grid.RowDefinitions>

        <!-- Ligne du haut : COM + bouton Terminal -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Zone COM à gauche -->
            <StackPanel Orientation="Horizontal" Grid.Column="0">
                <ComboBox x:Name="cmbPorts" Width="120" Margin="0,0,10,0"/>
                <Button x:Name="btnRefresh" 
                Background="#2D2F36" 
                BorderBrush="#3A86FF" 
                BorderThickness="2" 
                Content="Rafraîchir" 
                Foreground="White"
                Width="80" 
                Margin="0,0,10,0" 
                Click="BtnRefresh_Click"/>
                <Button x:Name="btnOpen" 
                Background="#2D2F36" 
                BorderBrush="#3A86FF" 
                BorderThickness="2" 
                Foreground="White"
                Content="Ouvrir COM" 
                Width="100" 
                Margin="0,0,10,0" 
                Click="BtnOpen_Click"/>
                <Button x:Name="btnClose" 
                Background="#2D2F36" 
                BorderBrush="#3A86FF" 
                BorderThickness="2" 
                Foreground="White"
                Content="Fermer COM" 
                Width="100" 
                Margin="0,0,10,0" 
                Click="BtnClose_Click"/>
                <Ellipse x:Name="ellipseStatus" Width="20" Height="20" Fill="Red" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Bouton Terminal à droite -->
            <Button x:Name="btnOpenTerminal"
                    Grid.Column="1"
                    Content="Terminal"
                    Width="120"
                    Margin="10,0,0,0"
                    Background="#2D2F36"
                    Foreground="White"
                    BorderBrush="#3A86FF"
                    BorderThickness="2"
                    FontWeight="Bold"
                    Click="BtnOpenTerminal_Click"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"/>
            
            <!-- Bouton à propos/GitHub -->
            <Border Grid.Column="2"
                    Margin="10,0,0,0"
                    Background="Transparent"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Cursor="Hand"
                    MouseLeftButtonUp="BtnAbout_Click">
                        <Image Source="/Images/GitHubLogo.png"
                        Width="26" Height="26"
                        Stretch="Uniform"
                        ToolTip="Voir le projet sur GitHub"/>
            </Border>
        </Grid>


        <!-- Infos état -->
        <StackPanel Grid.Row="1" Margin="0,10,0,10">
            <TextBlock x:Name="txtEtape" FontSize="24" FontWeight="Bold" Margin="0,0,0,5"/>
            <TextBlock x:Name="txtInstructions" FontSize="16" TextWrapping="Wrap"/>
        </StackPanel>

        <!-- Image étape -->
        <Image x:Name="imgEtape" Grid.Row="2" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="1300" MaxHeight="844"/>

        <!-- Zone saisie PER (visible étape 1 uniquement) -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,10" Visibility="Collapsed" x:Name="panelPer">
            <TextBox x:Name="txtPer" 
                     Width="150" 
                     FontSize="20"
                     Margin="0,0,10,0"
                     MaxLength="8"
                     KeyDown="TxtPer_KeyDown"
                     Background="#2D2F36" 
                     BorderBrush="#3A86FF" 
                     BorderThickness="2" 
                     Foreground="White"/>
            <Button x:Name="btnSendPer" 
                    Content="Envoyer PER" 
                    Width="120" 
                    Click="BtnSendPer_Click"
                    Background="#2D2F36" 
                    BorderBrush="#3A86FF" 
                    BorderThickness="2" 
                    Foreground="White"/>
        </StackPanel>

        <!-- Zone STS (visible étape 2 uniquement) -->
        <StackPanel 
    Grid.Row="2" 
    Orientation="Vertical" 
    HorizontalAlignment="Center"  
    VerticalAlignment="Center"
    Visibility="Collapsed" 
    x:Name="panelSts">


            <WrapPanel 
                x:Name="wrapSTS" 
                HorizontalAlignment="Left" 
                Orientation="Vertical" />

            <TextBlock 
                Text="STS EN COURS..." 
                HorizontalAlignment="Center"
                Margin="0,0,0,5"
                FontWeight="Bold"
                Foreground="#3A86FF"/>

            <ProgressBar 
                x:Name="LoadingBarSTS"
                IsIndeterminate="True"
                Width="300"
                Height="20"
                Foreground="#3A86FF" 
                HorizontalAlignment="Center"/>
        </StackPanel>


        <!-- Zone DIPs -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" x:Name="panelDips" Visibility="Collapsed" VerticalAlignment="Center" HorizontalAlignment="Center">
            <WrapPanel x:Name="wrapDips" HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Zone INPs -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" x:Name="panelInps" Visibility="Collapsed" VerticalAlignment="Center" HorizontalAlignment="Center">
            <WrapPanel x:Name="wrapInps" HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Zone TST -->
        <Grid x:Name="TST_LED_Anim" Grid.Row="2" Visibility="Collapsed">
            <Image gif:ImageBehavior.AnimatedSource="Images/EL418_TST_ANIM.gif"
               Stretch="Uniform"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"/>
        </Grid>

        <!-- Zone OPTIQUES -->
        <Grid x:Name="OPT_Anim" Grid.Row="2" Visibility="Collapsed">
            <Image gif:ImageBehavior.AnimatedSource="Images/OPT_ANIM.gif"
                Stretch="Uniform"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"/>
        </Grid>

        <!-- Boutons test Étape + / Étape - -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,10">
            <Button Content="Étape -" Width="100" Margin="10" Click="BtnPrevStep_Click"/>
            <Button Content="Étape +" Width="100" Margin="10" Click="BtnNextStep_Click"/>
        </StackPanel>

        <!-- Log console / trames reçues -->
        <Border Grid.Row="5" CornerRadius="10" Background="Black" BorderThickness="2" BorderBrush="#3A86FF">
            <TextBox x:Name="txtLog"
             AcceptsReturn="True"
             VerticalScrollBarVisibility="Auto"
             IsReadOnly="True"
             TextWrapping="Wrap"
             Background="Transparent"
             Foreground="White"
             BorderThickness="0"/>
        </Border>
    </Grid>
</Window>
